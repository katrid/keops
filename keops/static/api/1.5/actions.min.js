(function(){var Action,WindowAction,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Action=function(){Action.prototype.actionType=null;function Action(info1,scope1,location1){this.info=info1;this.scope=scope1;this.location=location1}Action.prototype.apply=function(){};Action.prototype.execute=function(scope){};return Action}();WindowAction=function(superClass){extend(WindowAction,superClass);WindowAction.actionType="sys.action.window";function WindowAction(info,scope,location){WindowAction.__super__.constructor.call(this,info,scope,location);this.viewMode=info.view_mode;this.viewModes=this.viewMode.split(",");this.viewType=null;this.cachedViews={}}WindowAction.prototype.routeUpdate=function(search){if(search.view_type!=null){if(this.viewType!==search.view_type){this.viewType=search.view_type;this.execute();if(this.scope.records==null){this.scope.search({})}}if(search.id&&(this.scope.record!=null&&this.scope.record.id!==search.id||this.scope.record==null)){return this.scope.get(search.id)}}else{return this.setViewType(this.viewModes[0])}};WindowAction.prototype.setViewType=function(viewType){return this.location.search({view_type:viewType})};WindowAction.prototype.apply=function(){return this.render(this.scope,this.scope.view.content,this.viewType)};WindowAction.prototype.execute=function(){var me,r,scope,view;scope=this.scope;me=this;view=this.cachedViews[this.viewType];if(view){scope.view=view;return me.apply()}else{r=this.scope.model.getViewInfo({view_type:this.viewType});r.success(function(res){view=res.result;me.cachedViews[me.viewType]=view;scope.view=view;return me.scope.$apply(function(){return me.apply()})});return r}};WindowAction.prototype.render=function(scope,html,viewType){return scope.setContent(Katrid.UI.Utils.Templates["render_"+viewType](scope,html))};return WindowAction}(Action);this.Katrid.Actions={Action:Action,WindowAction:WindowAction};this.Katrid.Actions[WindowAction.actionType]=WindowAction}).call(this);